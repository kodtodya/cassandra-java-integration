package com.avadhut.samples;

import com.datastax.driver.core.Cluster;
import com.datastax.driver.core.Session;
import com.datastax.driver.core.exceptions.AlreadyExistsException;
import com.datastax.driver.core.exceptions.SyntaxError;

public class CassandraConnectivity {

	private static final String KEYSPACE = "mykeyspace";
	public static void main(String[] args) {
		
		//Create the builder
		Cluster.Builder myBuilder = Cluster.builder().addContactPoint("127.0.0.1");
		
		//Creating cluster
		Cluster cluster = myBuilder.build();
		
		//Create/connect to session
		Session session = cluster.connect();
		
		//Create query to create keyspace
		String createkeySpaceQuery="CREATE KEYSPACE "+ KEYSPACE +" WITH replication " + "= {'class':'SimpleStrategy','replication_factor':3}; ";
		
		try {
		session.execute(createkeySpaceQuery);
		System.out.println("Creating KEYSPACE"+ KEYSPACE +"..");
		System.out.println(createkeySpaceQuery);
		}catch (AlreadyExistsException e) {
			System.err.println(e.equals(e.getMessage()));
		}
		
		//create query to alter the keyspace
		String alterKeySpaceQuery = "ALTER KEYSPACE " + KEYSPACE + " WITH replication = {'class': 'SimpleStrategy'," + "'replication_factor' : '"+ 1 +"'};";

		try {
		session.execute(alterKeySpaceQuery);
		System.out.println("Altering KEYSPACE"+ KEYSPACE +"..");
		System.out.println(alterKeySpaceQuery);
		}catch (SyntaxError e) {
			System.err.println(e.getMessage());
		}
		
		//create query to drop the keyspace
		String dropKeySpaceQuery = "DROP KEYSPACE " + KEYSPACE + " ;";
		try {
			session.execute(dropKeySpaceQuery);
			
			System.out.println("Dropping KEYSPACE"+KEYSPACE);
			System.out.println(dropKeySpaceQuery);
			}catch (Exception e) {
				System.err.println(e.getMessage());
			}
		
		
		
		//create Query to create table in keyspace
		String query="CREATE TABLE emp(emp_id int PRIMARY KEY, "
		+ "emp_name text, "
		+ "emp_city text, "
		+ "emp_sal varint, "
		+ "emp_phone varint );";
		session.execute(query);
	}

}
